(()=>{"use strict";class t{static add(e,s=0,i=0,a=-1,h=-1){t.imagesString.push(e),t.imagesStat.push([s,i,a,h])}static draw(){const e=t.imagesString.length;let s=0;for(let i=0;i<e;i++)t.images[i]=new Image,t.images[i].src=t.imagesString[i],t.images[i].onload=function(){s++,s==e&&t.drawImage()}}static drawImage(){var e,s;for(let i=0;i<t.imagesString.length;i++)-1==t.imagesStat[i][2]?null===(e=t.ctx)||void 0===e||e.drawImage(t.images[i],t.imagesStat[i][0],t.imagesStat[i][1]):null===(s=t.ctx)||void 0===s||s.drawImage(t.images[i],t.imagesStat[i][0],t.imagesStat[i][1],t.imagesStat[i][2],t.imagesStat[i][3]);t.imagesString.length=0,t.imagesStat.length=0}}t.canvas=document.getElementById("game"),t.ctx=t.canvas.getContext("2d"),t.imagesString=[],t.imagesStat=[],t.images=[];class e{constructor(t){this.sprites=t,this.idx=0,this.delay=0}getSprite(){return this.idx>=this.sprites.length&&console.log("Error Sprites"),this.sprites[this.idx]}goToNext(t){return this.delay+=1*t,this.delay>10&&(this.idx++,this.delay=0),this.idx%=this.sprites.length,this.idx}setIdx(t){this.idx=t%this.sprites.length}getSpritesLength(){return this.sprites.length}getIdx(){return this.idx}}var s;!function(t){t[t.MOVE=1]="MOVE",t[t.JUMP=2]="JUMP",t[t.FALL=3]="FALL",t[t.DEAD=4]="DEAD",t[t.IDLE=5]="IDLE",t[t.DUCK=6]="DUCK"}(s||(s={}));class i{constructor(){console.log("TRex created"),this.moveSprite=new e(["assets/dinosaur-sprites/Run (1).png","assets/dinosaur-sprites/Run (2).png","assets/dinosaur-sprites/Run (3).png","assets/dinosaur-sprites/Run (4).png","assets/dinosaur-sprites/Run (5).png","assets/dinosaur-sprites/Run (6).png","assets/dinosaur-sprites/Run (7).png","assets/dinosaur-sprites/Run (8).png"]),this.jumpSprite=new e(["assets/dinosaur-sprites/Jump (1).png","assets/dinosaur-sprites/Jump (2).png","assets/dinosaur-sprites/Jump (3).png","assets/dinosaur-sprites/Jump (4).png","assets/dinosaur-sprites/Jump (5).png","assets/dinosaur-sprites/Jump (6).png","assets/dinosaur-sprites/Jump (7).png","assets/dinosaur-sprites/Jump (8).png"]),this.fallSprite=new e(["assets/dinosaur-sprites/Jump (9).png","assets/dinosaur-sprites/Jump (10).png","assets/dinosaur-sprites/Jump (11).png","assets/dinosaur-sprites/Jump (12).png"]),this.deadSprite=new e(["assets/dinosaur-sprites/Dead (6).png"]),this.idleSprite=new e(["assets/dinosaur-sprites/Idle (1).png"]),this.duckSprite=new e(["assets/dinosaur-sprites/Duck (1).png"]),this.start()}start(){this.xDefault=10,this.yDefault=250,this.jumpSizeDefault=5,this.widthDefault=100,this.heightDefault=100,this.width=this.widthDefault,this.height=this.heightDefault,this.x=this.xDefault,this.y=this.yDefault,this.jumpSize=this.jumpSizeDefault,this.state=s.MOVE}update(t){switch(this.state){case s.MOVE:this.move(t);break;case s.JUMP:this.jump(t);break;case s.FALL:this.fall(t);break;case s.DEAD:this.dead();break;case s.IDLE:this.idle();break;case s.DUCK:this.duck()}}getX(){return this.x}getY(){return this.y}getWidth(){return this.width}getHeight(){return this.height}setX(t){this.x=t}setY(t){this.y=t}setWidth(t){this.width=t}setHeight(t){this.height=t}getState(){return this.state}setState(t){this.state=t}getJumpSize(){return this.jumpSize}setJumpSize(t){this.jumpSize=t}resetX(){this.x=this.xDefault}resetY(){this.y=this.yDefault}resetWidth(){this.width=this.widthDefault}resetHeight(){this.height=this.heightDefault}resetJumpSize(){this.jumpSize=this.jumpSizeDefault}move(e){this.resetX(),this.resetY(),this.resetWidth(),this.resetHeight(),this.fallSprite.setIdx(0),this.jumpSprite.setIdx(0),this.moveSprite.goToNext(e),t.add(this.moveSprite.getSprite(),this.x,this.y,this.width,this.height)}jump(e){this.resetWidth(),this.resetHeight(),this.resetJumpSize(),this.moveSprite.setIdx(0),this.fallSprite.setIdx(0),this.y-=this.jumpSize*e-.5*e*e*1,this.jumpSprite.getIdx()+1<this.jumpSprite.getSpritesLength()&&this.jumpSprite.goToNext(e),this.y<=this.yDefault-50*this.jumpSize&&(this.state=s.FALL),t.add(this.jumpSprite.getSprite(),this.x,this.y,this.width,this.height)}fall(e){this.resetWidth(),this.resetHeight(),this.jumpSprite.setIdx(0),this.moveSprite.setIdx(0),this.y+=this.jumpSize/2*e+.5*e*e,this.fallSprite.getIdx()+2<this.fallSprite.getSpritesLength()&&this.fallSprite.goToNext(e),this.y+10*this.jumpSize>=this.yDefault&&this.fallSprite.setIdx(this.fallSprite.getSpritesLength()-2),this.y+20*this.jumpSize>=this.yDefault&&this.fallSprite.setIdx(this.fallSprite.getSpritesLength()-1),this.y>=this.yDefault&&(this.y=this.yDefault,this.state=s.MOVE,this.fallSprite.setIdx(0)),t.add(this.fallSprite.getSprite(),this.x,this.y,this.width,this.height)}dead(){this.width=4*this.widthDefault/3-10,this.height=2*this.heightDefault/3-10,this.y=this.heightDefault-this.height+10+this.yDefault,t.add(this.deadSprite.getSprite(),this.x,this.y,this.width,this.height)}idle(){this.resetY(),t.add(this.idleSprite.getSprite(),this.x,this.y,this.width,this.height)}duck(){this.width=4*this.widthDefault/3-10,this.height=2*this.heightDefault/3-10,this.y=this.heightDefault-this.height+10+this.yDefault,t.add(this.duckSprite.getSprite(),this.x,this.y,this.width,this.height)}}class a{constructor(){}render(){const e=new Image;e.src=this.sprite.getSprite();const s=this.width,i=this.height,a=this.y,h=this.x;t.add(e.src,h,a,s,i)}getX(){return this.x}getY(){return this.y}getWidth(){return this.width}setX(t){this.x=t}getMoveSpeed(){return this.moveSpeed}}class h extends a{constructor(t){super(),this.sprite=new e(["assets/Cactus/Cactus.png"]),this.x=t,this.width=60,this.height=80,this.y=280,this.moveSpeed=0}}class r extends a{constructor(t){super(),this.sprite=new e(["assets/fly-dinosaur/1.png","assets/fly-dinosaur/2.png"]),this.sprite.setIdx(Math.floor(2*Math.random())),this.x=t,this.width=80,this.height=50,this.y=70*Math.floor(2*Math.random())+150,this.moveSpeed=.5}}class n{constructor(){this.obstacles=[];const t=[1,2,4,4,5,6,6,8,8,10];t.sort((()=>Math.random()));for(let e=0;e<10;e++)t[e]%2?this.obstacles.push(new r(0)):this.obstacles.push(new h(0));this.start()}start(){let t=0;for(let e=0;e<10;e++)t=Math.floor(1e3*Math.random())+400+t,this.obstacles[e].setX(t)}update(t,e=!1){const s=[];for(let i=0;i<this.obstacles.length;i++)this.obstacles[i].getX()<=x&&this.obstacles[i].render(),e||(this.obstacles[i].getX()<=x&&this.obstacles[i].setX(this.obstacles[i].getX()-this.obstacles[i].getMoveSpeed()*t),this.obstacles[i].setX(this.obstacles[i].getX()-m.getGameSpeed()*t)),this.obstacles[i].getX()<-this.obstacles[i].getWidth()&&!e&&s.push(i);if(e)return;let i=0;for(let t=0;t<this.obstacles.length;t++)i=i>this.obstacles[t].getX()?i:this.obstacles[t].getX();for(let t=0,e=0;t<s.length;t++)e=s[t],i+=Math.floor(1e3*Math.random())+400,this.obstacles[e].setX(i)}checkCollision(t){let e,s,i;const a=t.getX(),h=t.getY(),r=t.getWidth()-20;for(let t=0;t<this.obstacles.length;t++)if(e=this.obstacles[t].getX(),s=this.obstacles[t].getY(),i=this.obstacles[t].getWidth()-10,a+r>=e&&e+i>=a&&h+r>=s&&s+i>=h)return!0;return!1}}class g{constructor(){this.maxScore=0,this.start()}start(){this.score=0,this.level=1e3}update(e,s=!1){s?this.maxScore=this.maxScore>this.score?this.maxScore:this.score:(this.score+=m.getGameSpeed()/5*e,this.score>this.level&&(m.setGameSpeed(.5*e+m.getGameSpeed()),this.level+=1e3)),t.ctx&&(t.ctx.font="30px Cambria",t.ctx.textAlign="start",t.ctx.fillText(Math.floor(this.score).toString(),20,30))}getScore(){return this.score}getMaxScore(){return this.maxScore}}const o=["assets/background/1.png","assets/background/3.png"];class c{constructor(){this.list=[],this.idx=0;for(let t=0;t<6;t++){const t=o[Math.floor(Math.random()*o.length)];for(let e=0;e<5;e++)this.list.push(t)}}getCurrent(){return this.list[this.idx]}getNext(){return this.list[(this.idx+1)%this.list.length]}setIdx(t){this.idx=t%this.list.length}getIdx(){return this.idx}goToNext(){this.idx=(this.idx+1)%this.list.length}}class u{constructor(){}display(e){const s=e.getBackground().getCurrent(),i=e.getBackground().getNext();t.add(s,e.getSceneNum(),0),e.getSceneNum()<=t.canvas.width-x&&t.add(i,e.getSceneNum()+x,0)}update(t,e){}clear(t){}}class d extends u{constructor(e){super(),t.canvas.addEventListener("mousedown",(t=>this.handleMouseDown(t,e)),!1)}display(e){super.display(e),t.ctx&&(t.ctx.font="bold 50px Cambria",t.ctx.textAlign="center",t.ctx.fillText("T-Rex Jump",350,150),t.ctx.font="30px Cambria",t.ctx.fillText(`Highscore: ${e.getScore().getMaxScore()}`,350,200),t.ctx.beginPath(),t.ctx.arc(350,260,40,0,2*Math.PI),t.ctx.stroke(),t.ctx.beginPath(),t.ctx.moveTo(340,240),t.ctx.lineTo(340,280),t.ctx.lineTo(370,260),t.ctx.fill())}update(t,e){t.getTRex().setState(s.IDLE),t.getTRex().update(e),t.getObstacleManager().update(e,!0),t.getTRex().update(e)}handleMouseDown(e,s){const i=t.canvas.getBoundingClientRect(),a=e.clientX-i.left,h=e.clientY-i.top;(a-350)*(a-350)+(h-260)*(h-260)<1600&&(s.start(),s.getStateManager().getCurrentState().clear(s),s.getStateManager().setCurrentState(new p(s)))}clear(e){t.canvas.removeEventListener("mousedown",(t=>this.handleMouseDown(t,e)),!1)}}class l extends u{constructor(e){super(),t.canvas.addEventListener("mousedown",(t=>this.handleMouseDown(t,e)),!1)}display(e){super.display(e),t.ctx&&(t.ctx.font="bold 50px Cambria",t.ctx.textAlign="center",t.ctx.fillText("GAME OVER",350,150),t.ctx.font="30px Cambria",t.ctx.fillText(`Highscore: ${Math.floor(e.getScore().getMaxScore())}`,350,200),t.ctx.beginPath(),t.ctx.arc(350,260,40,0,2*Math.PI),t.ctx.stroke(),t.ctx.beginPath(),t.ctx.moveTo(340,240),t.ctx.lineTo(340,280),t.ctx.lineTo(370,260),t.ctx.fill())}update(t,e){t.getTRex().setState(s.DEAD),t.getTRex().update(e),t.getObstacleManager().update(e,!0),t.getScore().update(e,!0),t.getTRex().update(e)}handleMouseDown(e,s){const i=t.canvas.getBoundingClientRect(),a=e.clientX-i.left,h=e.clientY-i.top;(a-350)*(a-350)+(h-260)*(h-260)<1600&&(s.start(),s.getStateManager().getCurrentState().clear(s),s.getStateManager().setCurrentState(new p(s)))}clear(e){t.canvas.removeEventListener("mousedown",(t=>this.handleMouseDown(t,e)),!1)}}class p extends u{constructor(e){super(),this.touchStart=[],this.touchEnd=[],t.canvas.addEventListener("keydown",(t=>this.handleKeyDown(t,e)),!0),t.canvas.addEventListener("keyup",(t=>this.handleKeyUp(t,e)),!0),t.canvas.addEventListener("touchstart",(t=>this.handleTouchStart(t)),!1),t.canvas.addEventListener("touchend",(t=>this.handleTouchEnd(t,e)),!1)}display(t){super.display(t)}update(t,e){t.setSceneNum(t.getSceneNum()-m.getGameSpeed()/e),t.getSceneNum()<=-x&&(t.setSceneNum(t.getSceneNum()+x),t.getBackground().goToNext()),t.getTRex().update(e),t.getScore().update(e),t.getObstacleManager().update(e),t.getObstacleManager().checkCollision(t.getTRex())&&(t.getStateManager().getCurrentState().clear(t),t.getStateManager().setCurrentState(new l(t)))}clear(e){t.canvas.removeEventListener("keydown",(t=>this.handleKeyDown(t,e)),!0),t.canvas.removeEventListener("keyup",(t=>this.handleKeyUp(t,e)),!0),t.canvas.removeEventListener("touchstart",(t=>this.handleTouchStart(t)),!1),t.canvas.removeEventListener("touchend",(t=>this.handleTouchEnd(t,e)),!1)}handleKeyDown(t,e){switch(t.code){case"ArrowUp":case"Space":e.getTRex().getState()!==s.FALL&&e.getTRex().setState(s.JUMP);break;case"ArrowDown":e.getTRex().getState()!==s.JUMP&&e.getTRex().getState()!==s.FALL||(e.getTRex().setJumpSize(3*e.getTRex().getJumpSize()),e.getTRex().setState(s.FALL)),e.getTRex().getState()===s.MOVE&&e.getTRex().setState(s.DUCK)}}handleKeyUp(t,e){switch(t.preventDefault(),t.code){case"ArrowUp":case"Space":e.getTRex().getState()==s.JUMP&&e.getTRex().setState(s.FALL);break;case"ArrowDown":e.getTRex().getState()==s.DUCK&&e.getTRex().setState(s.MOVE)}}handleTouchStart(t){const e=t.touches[0],s=e.clientX,i=e.clientY;this.touchStart[0]=s,this.touchStart[1]=i}handleTouchEnd(t,e){const i=t.changedTouches[0],a=i.clientX,h=i.clientY;switch(this.touchEnd[0]=a,this.touchEnd[1]=h,this.getDirection()){case"U":e.getTRex().getState()!==s.FALL&&e.getTRex().setState(s.JUMP);break;case"D":e.getTRex().getState()!==s.JUMP&&e.getTRex().getState()!==s.FALL||(e.getTRex().setJumpSize(2*e.getTRex().getJumpSize()),e.getTRex().setState(s.FALL)),e.getTRex().getState()===s.MOVE&&e.getTRex().setState(s.DUCK)}this.touchStart.length=this.touchEnd.length=0}getDirection(){if(2!=this.touchStart.length||2!=this.touchEnd.length)return"N";const t=this.touchEnd[0]-this.touchStart[0],e=this.touchEnd[1]-this.touchStart[1];return t<0&&e<0?Math.abs(t)<Math.abs(e)?"U":"L":t<0&&e>0?Math.abs(t)<Math.abs(e)?"D":"L":t>0&&e<0?Math.abs(t)<Math.abs(e)?"U":"R":t>0&&e>0?Math.abs(t)<Math.abs(e)?"D":"R":"N"}}class S{constructor(t){this.currentState=new d(t)}setCurrentState(t){this.currentState=t}getCurrentState(){return this.currentState}updateCurrentState(t,e){this.currentState.update(t,e)}displayCurrentState(t){this.currentState.display(t)}}const x=1e3;class m{constructor(){console.log("TRexJump created"),t.canvas.width=700,t.canvas.height=400,t.canvas.setAttribute("style","margin: auto; position: fixed"),this.background=new c,this.stateManager=new S(this),this.tRex=new i,this.obstacleManager=new n,this.score=new g,this.start()}start(){this.tRex.start(),this.obstacleManager.start(),this.score.start(),this.sceneNum=0,m.gameSpeed=5}update(e){e/=10,this.stateManager.displayCurrentState(this),this.stateManager.updateCurrentState(this,e),t.draw()}static setGameSpeed(t){m.gameSpeed=t}static getGameSpeed(){return m.gameSpeed}getBackground(){return this.background}getSceneNum(){return this.sceneNum}setSceneNum(t){this.sceneNum=t}getTRex(){return this.tRex}getObstacleManager(){return this.obstacleManager}getScore(){return this.score}getStateManager(){return this.stateManager}}(new class{constructor(){this.tRexJump=new m}update(t){const e=Date.now();this.tRexJump.update(e-t),t=Date.now(),requestAnimationFrame((()=>this.update(t)))}start(){requestAnimationFrame((()=>this.update(Date.now())))}}).start()})();